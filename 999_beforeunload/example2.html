<!DOCTYPE html>
<html data-ng-app="TestApp">

<head>
    <meta charset="utf-8" />
    <script src="http://code.angularjs.org/1.2.9/angular.js"></script>
    <script>
        // angular.module('app', [])
        //     .controller('exitController', function ($scope, $window) {
        //         $scope.onExit = function () {
        //             console.log('bye bye');
        //             return ('bye bye');
        //         };

        //         $window.onbeforeunload = $scope.onExit;
        //     });
    </script>
</head>

<body ng-app="">
    <div ng-controller="exitController">
        <a href="http://www.disney.com">Leave page</a>
    </div>

    <script>
        var exitController = function ($scope, $window) {
            // console.log('$scope', $scope);
            // console.log('$window', $window);

            // $scope.onExit = function () {
            //     console.log('bye bye');
            //     return ('bye bye');
            // };

            handleWindowClose();
            $scope.onExit = function () {
                console.info('performance.navigation.type', performance.navigation.type);
                console.info("若user不是按 【refresh】");
                console.log('呼叫【登出】');
            }
            return ('bye bye');

            $window.onbeforeunload = $scope.onExit;
        }


    </script>
</body>

</html>

<!-- https://stackoverflow.com/questions/30345446/how-to-trigger-a-function-on-window-close-using-angularjs -->
<!-- https://stackoverflow.com/questions/5004978/check-if-page-gets-reloaded-or-refreshed-in-javascript -->

<!-- check for navigation time API support
 if (window.performance) {
     console.info("window.performance work's fine on this browser");
 }
 if (performance.navigation.type == 1) {
     console.info("This page is reloaded");
 } else {
     console.info("This page is not reloaded");
 } -->